<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario dell'Avvento</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    
<div class="header-container">
    <h1>Calendario dell'Avvento</h1>
    <p>Un viaggio di 24 giorni di Meraviglia</p>
</div>

<div class="calendario-grid-container" id="calendario">
    <!-- I giorni verranno generati dinamicamente -->
</div>

<!-- Modal Principale -->
<div class="modal-overlay" id="modal">
    <div class="modal-content">
        <!-- Intestazione con Navigazione -->
        <div class="navigazione-giorni">
            <button class="btn-navigazione" onclick="cambiaGiorno(-1)">‚Üê Porta precedente</button>
            <div class="giorno-corrente">
                <span class="data-giorno" id="dataGiorno">13 dicembre</span>
                <span class="numero-giorno" id="numeroGiorno">13</span>
            </div>
            <button class="btn-navigazione" onclick="cambiaGiorno(1)">Accanto ‚Üí</button>
        </div>

        <!-- Anteprima Contenuto -->
        <div class="anteprima-contenuto" id="anteprimaContenuto">
            <div id="contenutoVisuale">
                <p class="nessun-contenuto">Nessun contenuto per questo giorno</p>
            </div>
        </div>

        <!-- Selezione Tipo Contenuto -->
        <div class="selezione-tipo">
            <h4>Scegli il tipo di contenuto:</h4>
            <div class="grid-tipo-contenuto">
                <button class="btn-tipo" onclick="selezionaTipo('foto')">
                    <span class="icona">üì∏</span>
                    <span>Foto</span>
                </button>
                <button class="btn-tipo" onclick="selezionaTipo('messaggio')">
                    <span class="icona">üí¨</span>
                    <span>Messaggio</span>
                </button>
                <button class="btn-tipo" onclick="selezionaTipo('messaggio-vocale')">
                    <span class="icona">üé§</span>
                    <span>Messaggio vocale</span>
                </button>
                <button class="btn-tipo" onclick="selezionaTipo('audio')">
                    <span class="icona">üéµ</span>
                    <span>Audio</span>
                </button>
                <button class="btn-tipo" onclick="selezionaTipo('musica')">
                    <span class="icona">üé∂</span>
                    <span>Musica</span>
                </button>
                <button class="btn-tipo" onclick="selezionaTipo('youtube')">
                    <span class="icona">‚ñ∂Ô∏è</span>
                    <span>Video di YouTube</span>
                </button>
                <button class="btn-tipo" onclick="selezionaTipo('video')">
                    <span class="icona">üé•</span>
                    <span>Video</span>
                </button>
            </div>
        </div>

        <!-- Editor Dinamico -->
        <div class="editor-dinamico" id="editorDinamico">
            <div id="editorContainer"></div>
        </div>

        <!-- Azioni -->
        <div class="azioni">
            <button class="bottone" onclick="salvaContenuto()">üíæ Salva</button>
            <button class="bottone-elimina" onclick="eliminaContenuto()">üóëÔ∏è Elimina</button>
            <button class="bottone-chiusura" onclick="chiudiModale()">‚ùå Chiudi</button>
        </div>

        <!-- Info Debug -->
        <div class="debug-info">
            <span>Giorno: <strong id="debugDay">-</strong></span>
            <span>Tipo: <strong id="debugTipo">-</strong></span>
        </div>
    </div>
</div>

<script>
    // Variabili globali
    const calendario = document.getElementById("calendario");
    const modale = document.getElementById("modal");
    const anteprimaContenuto = document.getElementById("anteprimaContenuto");
    const contenutoVisuale = document.getElementById("contenutoVisuale");
    const editorDinamico = document.getElementById("editorDinamico");
    const editorContainer = document.getElementById("editorContainer");
    const dataGiorno = document.getElementById("dataGiorno");
    const numeroGiorno = document.getElementById("numeroGiorno");
    const debugDay = document.getElementById("debugDay");
    const debugTipo = document.getElementById("debugTipo");

    let currentDay = null;
    let currentTipo = null;
    const mesi = ["gennaio", "febbraio", "marzo", "aprile", "maggio", "giugno", 
                  "luglio", "agosto", "settembre", "ottobre", "novembre", "dicembre"];

    // 1. Generazione calendario
    function generaCalendario() {
        calendario.innerHTML = '';
        for (let i = 1; i <= 24; i++) {
            const giorno = document.createElement("button");
            giorno.classList.add("pulsante");
            giorno.innerHTML = `
                <span class="numero-giorno">${i}</span>
                <span class="data-giorno">${i} dicembre</span>
            `;
            giorno.setAttribute('data-giorno', i);
            giorno.onclick = () => apriGiornata(i); 
            calendario.appendChild(giorno);
            aggiornaStatoPulsante(i);
        }
    }

    // 2. Aggiorna stato pulsante
    function aggiornaStatoPulsante(giorno) {
        const pulsante = document.querySelector(`.pulsante[data-giorno="${giorno}"]`);
        if (!pulsante) return;
        
        const savedContent = localStorage.getItem(`giorno${giorno}`);
        if (savedContent && savedContent.trim() !== '') {
            pulsante.classList.add('contenutoSalvato');
        } else {
            pulsante.classList.remove('contenutoSalvato');
        }
    }

    // 3. Apri giornata
    function apriGiornata(giorno) {
        currentDay = giorno;
        debugDay.textContent = giorno;
        
        // Aggiorna interfaccia
        dataGiorno.textContent = `${giorno} dicembre`;
        numeroGiorno.textContent = giorno;
        
        // Resetta selezione tipo
        currentTipo = null;
        debugTipo.textContent = '-';
        editorContainer.innerHTML = '';
        editorDinamico.style.display = 'none';
        
        // Carica contenuto salvato
        const savedContent = localStorage.getItem(`giorno${giorno}`);
        visualizzaContenuto(savedContent);
        
        modale.classList.add("mostra");
    }

    // 4. Selezione tipo contenuto
    function selezionaTipo(tipo) {
        currentTipo = tipo;
        debugTipo.textContent = tipo;
        
        // Rimuovi selezione precedente
        document.querySelectorAll('.btn-tipo').forEach(btn => {
            btn.classList.remove('selezionato');
        });
        
        // Aggiungi selezione corrente
        event.currentTarget.classList.add('selezionato');
        
        // Mostra editor appropriato
        editorDinamico.style.display = 'block';
        mostraEditorPerTipo(tipo);
    }

    // 5. Mostra editor per tipo
    function mostraEditorPerTipo(tipo) {
        let html = '';
        
        switch(tipo) {
            case 'foto':
                html = `
                    <div class="editor-tipo">
                        <h4>üì∏ Carica Foto</h4>
                        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                            <p>Clicca qui per selezionare un'immagine</p>
                            <small>Formati supportati: JPG, PNG, GIF (max 2MB)</small>
                        </div>
                        <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="anteprimaFoto(this)">
                        <div id="anteprimaFoto" style="margin-top: 15px;"></div>
                        <div class="link-alternativo" style="margin-top: 15px;">
                            <p>Oppure incolla link immagine:</p>
                            <input type="text" id="linkFoto" placeholder="https://esempio.com/foto.jpg" 
                                   style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                    </div>
                `;
                break;
                
            case 'messaggio':
                html = `
                    <div class="editor-tipo">
                        <h4>üí¨ Scrivi Messaggio</h4>
                        <textarea id="testoMessaggio" placeholder="Scrivi il tuo messaggio speciale..." 
                                  style="width: 100%; height: 150px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; resize: vertical;"></textarea>
                        <div class="suggerimenti-testo">
                            <button type="button" onclick="inserisciTestoEsempio()" style="background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 3px; margin-top: 10px; cursor: pointer;">
                                Inserisci testo esempio
                            </button>
                        </div>
                    </div>
                `;
                break;
                
            case 'youtube':
                html = `
                    <div class="editor-tipo">
                        <h4>‚ñ∂Ô∏è Link YouTube</h4>
                        <input type="text" id="linkYouTube" placeholder="Incolla qui il link di YouTube..." 
                               style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <div class="esempi-link" style="margin-top: 10px;">
                            <small>Esempi: https://youtube.com/watch?v=... o https://youtu.be/...</small>
                        </div>
                    </div>
                `;
                break;
                
            case 'messaggio-vocale':
                html = `
                    <div class="editor-tipo">
                        <h4>üé§ Messaggio Vocale</h4>
                        <div class="registrazione-audio">
                            <button id="btnRegistra" onclick="iniziaRegistrazione()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px;">
                                üé§ Inizia Registrazione
                            </button>
                            <button id="btnFerma" onclick="fermaRegistrazione()" disabled style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px;">
                                ‚èπÔ∏è Ferma
                            </button>
                            <div id="statoRegistrazione" style="margin: 10px 0;"></div>
                            <audio id="audioPreview" controls style="width: 100%; margin: 10px 0;"></audio>
                        </div>
                        <div class="upload-audio" style="margin-top: 15px;">
                            <p>Oppure carica file audio:</p>
                            <input type="file" id="fileAudio" accept="audio/*" style="margin: 5px 0;">
                        </div>
                    </div>
                `;
                break;
                
            case 'audio':
            case 'musica':
                html = `
                    <div class="editor-tipo">
                        <h4>üéµ ${tipo === 'audio' ? 'File Audio' : 'Brano Musicale'}</h4>
                        <div class="upload-area" onclick="document.getElementById('fileAudioMusica').click()">
                            <p>Clicca qui per selezionare un file audio</p>
                            <small>Formati supportati: MP3, WAV, OGG (max 5MB)</small>
                        </div>
                        <input type="file" id="fileAudioMusica" accept="audio/*" style="display: none;">
                        <div class="link-alternativo" style="margin-top: 15px;">
                            <p>Oppure incolla link audio:</p>
                            <input type="text" id="linkAudio" placeholder="https://esempio.com/audio.mp3" 
                                   style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                    </div>
                `;
                break;
                
            case 'video':
                html = `
                    <div class="editor-tipo">
                        <h4>üé• Carica Video</h4>
                        <div class="upload-area" onclick="document.getElementById('fileVideo').click()">
                            <p>Clicca qui per selezionare un video</p>
                            <small>Formati supportati: MP4, WebM (max 10MB)</small>
                        </div>
                        <input type="file" id="fileVideo" accept="video/*" style="display: none;">
                        <div class="link-alternativo" style="margin-top: 15px;">
                            <p>Oppure incolla link video:</p>
                            <input type="text" id="linkVideo" placeholder="https://esempio.com/video.mp4" 
                                   style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                    </div>
                `;
                break;
        }
        
        editorContainer.innerHTML = html;
    }

    // 6. Anteprima foto
    function anteprimaFoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('anteprimaFoto').innerHTML = `
                    <img src="${e.target.result}" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                `;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // 7. Testo esempio
    function inserisciTestoEsempio() {
        const esempi = [
            "üéÑ Che questo Natale porti gioia e serenit√† nel tuo cuore!",
            "üåü Possano le luci del Natale illuminare il tuo cammino!",
            "‚ùÑÔ∏è Che la magia di questo periodo ti avvolga di felicit√†!",
            "üéÅ I migliori auguri per te e la tua famiglia!",
            "üïØÔ∏è Che lo spirito natalizio riscaldi il tuo cuore!"
        ];
        const esempio = esempi[Math.floor(Math.random() * esempi.length)];
        document.getElementById('testoMessaggio').value = esempio;
    }

    // 8. Registrazione audio (simulata)
    function iniziaRegistrazione() {
        document.getElementById('statoRegistrazione').innerHTML = '<span style="color: red;">‚óè Registrazione in corso...</span>';
        document.getElementById('btnRegistra').disabled = true;
        document.getElementById('btnFerma').disabled = false;
    }

    function fermaRegistrazione() {
        document.getElementById('statoRegistrazione').innerHTML = '<span style="color: green;">‚úì Registrazione completata</span>';
        document.getElementById('btnRegistra').disabled = false;
        document.getElementById('btnFerma').disabled = true;
        // Simula un audio di preview
        document.getElementById('audioPreview').innerHTML = 'Il tuo audio sar√† riproducibile dopo il salvataggio';
    }

    // 9. Salva contenuto
    function salvaContenuto() {
        if (!currentDay) {
            alert('‚ùå Nessun giorno selezionato!');
            return;
        }

        if (!currentTipo) {
            alert('‚ùå Seleziona un tipo di contenuto!');
            return;
        }

        let content = '';
        
        switch(currentTipo) {
            case 'foto':
                const linkFoto = document.getElementById('linkFoto');
                const fileInput = document.getElementById('fileInput');
                if (linkFoto && linkFoto.value) {
                    content = `FOTO:${linkFoto.value}`;
                } else if (fileInput && fileInput.files[0]) {
                    // Per file, salviamo un riferimento
                    content = `FOTO_FILE:${fileInput.files[0].name}`;
                }
                break;
                
            case 'messaggio':
                const testo = document.getElementById('testoMessaggio');
                if (testo && testo.value) {
                    content = `MESSAGGIO:${testo.value}`;
                }
                break;
                
            case 'youtube':
                const linkYT = document.getElementById('linkYouTube');
                if (linkYT && linkYT.value) {
                    content = `YOUTUBE:${linkYT.value}`;
                }
                break;
                
            case 'messaggio-vocale':
            case 'audio':
            case 'musica':
            case 'video':
                // Implementazione simile per altri tipi
                content = `${currentTipo.toUpperCase()}:Contenuto_salvato`;
                break;
        }

        if (!content) {
            alert('‚ùå Inserisci il contenuto prima di salvare!');
            return;
        }

        localStorage.setItem(`giorno${currentDay}`, content);
        aggiornaStatoPulsante(currentDay);
        visualizzaContenuto(content);
        alert(`‚úÖ Contenuto salvato per il Giorno ${currentDay}!`);
    }

    // 10. Visualizza contenuto
    function visualizzaContenuto(content) {
        if (!content) {
            contenutoVisuale.innerHTML = '<p class="nessun-contenuto">Nessun contenuto per questo giorno</p>';
            return;
        }

        const [tipo, valore] = content.split(':');
        
        switch(tipo) {
            case 'FOTO':
                contenutoVisuale.innerHTML = `
                    <div class="anteprima-tipo">
                        <h4>üì∏ Foto</h4>
                        <img src="${valore}" style="max-width: 100%; max-height: 300px; border-radius: 10px;">
                    </div>
                `;
                break;
                
            case 'MESSAGGIO':
                contenutoVisuale.innerHTML = `
                    <div class="anteprima-tipo">
                        <h4>üí¨ Messaggio</h4>
                        <div class="messaggio-testo">${valore}</div>
                    </div>
                `;
                break;
                
            case 'YOUTUBE':
                const videoId = getYoutubeVideoId(valore);
                if (videoId) {
                    contenutoVisuale.innerHTML = `
                        <div class="anteprima-tipo">
                            <h4>‚ñ∂Ô∏è Video YouTube</h4>
                            <iframe width="100%" height="250" src="https://www.youtube.com/embed/${videoId}" 
                                    frameborder="0" allowfullscreen style="border-radius: 10px;"></iframe>
                        </div>
                    `;
                } else {
                    contenutoVisuale.innerHTML = `
                        <div class="anteprima-tipo">
                            <h4>‚ñ∂Ô∏è Video YouTube</h4>
                            <a href="${valore}" target="_blank" class="link-esterno">Apri su YouTube</a>
                        </div>
                    `;
                }
                break;
                
            default:
                contenutoVisuale.innerHTML = `
                    <div class="anteprima-tipo">
                        <h4>üìÅ Contenuto Salvato</h4>
                        <p>${content}</p>
                    </div>
                `;
        }
    }

    // 11. Funzione helper per YouTube
    function getYoutubeVideoId(url) {
        const regex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
        const match = url.match(regex);
        return (match && match[1]) ? match[1] : null;
    }

    // 12. Elimina contenuto
    function eliminaContenuto() {
        if (!currentDay) return;
        
        if (confirm(`Sei sicuro di voler eliminare il contenuto del Giorno ${currentDay}?`)) {
            localStorage.removeItem(`giorno${currentDay}`);
            aggiornaStatoPulsante(currentDay);
            visualizzaContenuto(null);
            editorContainer.innerHTML = '';
            editorDinamico.style.display = 'none';
            alert(`üóëÔ∏è Contenuto eliminato!`);
        }
    }

    // 13. Navigazione tra giorni
    function cambiaGiorno(direzione) {
        if (!currentDay) return;
        
        const nuovoGiorno = currentDay + direzione;
        if (nuovoGiorno >= 1 && nuovoGiorno <= 24) {
            apriGiornata(nuovoGiorno);
        }
    }

    // 14. Chiudi modale
    function chiudiModale() {
        modale.classList.remove("mostra");
        currentDay = null;
        currentTipo = null;
    }

    // 15. Inizializzazione
    document.addEventListener('DOMContentLoaded', function() {
        generaCalendario();
        
        // Chiudi modal cliccando fuori
        modale.addEventListener('click', function(e) {
            if (e.target === modale) chiudiModale();
        });
        
        // Tasto ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') chiudiModale();
        });
    });

</script>

</body>
</html>

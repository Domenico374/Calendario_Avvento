<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario dell'Avvento</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header-container">
        <h1>Calendario dell'Avvento</h1>
        <img src="albero_natale.png" alt="Logo Albero di Natale" id="logo">
        <p>Un viaggio di 24 giorni di Meraviglia</p>
    </div>

    <div class="calendario-grid-container" id="calendario">
        </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            <div id="contenutoVisuale"></div> 
            <p>Scrivi qui o incolla un'immagine, video o link...</p>
            <div id="editor" contenteditable="true"></div>
            
            <div class="azioni">
                <button class="bottone" onclick="salvaContenuto()">üíæ Salva</button>
                <button class="bottone-chiusura" onclick="chiudiModale()">‚ùå Chiudi</button>
            </div>
        </div>
    </div>
    
    <script>
        const calendario = document.getElementById("calendario");
        const modale = document.getElementById("modal");
        const editor = document.getElementById("editor");
        const contenutoVisuale = document.getElementById("contenutoVisuale");
        let currentDay = null;

        for (let i = 1; i <= 24; i++) {
            const giorno = document.createElement("button");
            giorno.classList.add("pulsante");
            giorno.innerText = `Giorno ${i}`;
            giorno.onclick = () => apriGiornata(i); 
            calendario.appendChild(giorno);
            
            const savedContent = localStorage.getItem(`giorno${i}`);
            if (savedContent && savedContent.trim() !== '') {
                giorno.classList.add('contenutoSalvato');
            }
        }

        function apriGiornata(giorno) {
            currentDay = giorno;
            const savedContent = localStorage.getItem(`giorno${giorno}`);
            
            editor.innerText = savedContent || '';
            modale.classList.add("mostra"); // Applica la classe 'mostra' al modal-overlay
            visualizzaContenuto(savedContent); 
        }

        function visualizzaContenuto(content) {
            contenutoVisuale.innerHTML = '';
            if (!content || content.trim() === '') return;

            const trimmedContent = content.trim();

            if (trimmedContent.match(/\.(jpeg|jpg|gif|png)$/i)) {
                contenutoVisuale.innerHTML = `<img src="${trimmedContent}" alt="Contenuto immagine">`;
            } else if (trimmedContent.includes("youtube.com") || trimmedContent.includes("youtu.be")) {
                contenutoVisuale.innerHTML = `<iframe width="100%" height="200px" src="https://www.youtube.com/embed/${getYoutubeVideoId(trimmedContent)}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            } else if (trimmedContent.match(/^https?:\/\//i)) {
                contenutoVisuale.innerHTML = `<a href="${trimmedContent}" target="_blank">Apri Link</a>`;
            } else {
                contenutoVisuale.innerHTML = `<p>${trimmedContent}</p>`;
            }
        }

        // Funzione helper per estrarre l'ID del video YouTube
        function getYoutubeVideoId(url) {
            const regex = /(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|[^#]*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const match = url.match(regex);
            return (match && match[1]) ? match[1] : null;
        }

        function salvaContenuto() {
            const content = editor.innerText;
            localStorage.setItem(`giorno${currentDay}`, content);
            
            const buttons = calendario.querySelectorAll('.pulsante');
            const savedButton = buttons[currentDay - 1];
            if (content.trim() !== '') {
                savedButton.classList.add('contenutoSalvato');
            } else {
                savedButton.classList.remove('contenutoSalvato');
            }

            chiudiModale();
        }

        function chiudiModale() {
            modale.classList.remove("mostra");
            contenutoVisuale.innerHTML = ''; 
        }
    </script>
</body>
</html>
